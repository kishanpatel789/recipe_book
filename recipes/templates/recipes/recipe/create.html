{% extends "base.html" %}
{% load static %}
{% load recipe_extras %}

{% block title %}Create Recipe{% endblock %}

{% block content %}
<h1 class="text-3xl mt-6 mb-2">Create Recipe</h1>

<form method="POST">
    {% csrf_token %}
    {{ form.non_field_errors }}

    {{ form.name.errors }}
    {{ form.name|add_class:'form-input' }}


    <h2 class="text-2xl mt-2">Tags</h2>
    {{ form.tags.errors }}
    <div class="flex flex-wrap gap-4">
      {% for checkbox in form.tags %}
        <label class="inline-flex items-center gap-1">
          {{ checkbox.tag }}
          <span>{{ checkbox.choice_label }}</span>
        </label>
      {% endfor %}
    </div>

    <h2 class="text-2xl mt-2">Complementary Dishes</h2>
    {{ form.complementary.errors }}
    {{ form.complementary }}

    <hr class="hr">

    <div class="flex flex-row items-center my-2">
      <h2 class="text-2xl pr-2">Steps</h2>
      <div class="flex flex-row items-center justify-center space-x-2">
        <button id="remove-step" type="button" class="btn-icon">
          {% include "recipes/icons/remove.html" %}
        </button>
        <button id="add-step" type="button" class="btn-icon">
          {% include "recipes/icons/add.html" %}
        </button>
      </div>

    </div>
    {{ form_steps.management_form }}
    {{ form_stepingredients.management_form }}

    <ol id="step-list" class="list-decimal list-outside ml-4">
      {% for step in form_steps %}
        <li data-step-index="{{ forloop.counter0 }}">
          <div class="flex flex-row items-center justify-center space-x-2">
          {{ step.non_field_errors }}
          {{ step.instruction.errors }}
          {{ step.instruction|add_class:'form-input grow ml-2' }}
          <button class="remove-ingredient btn-icon" type="button">
            {% include "recipes/icons/remove.html" %}
          </button>
          <button class="add-ingredient btn-icon" type="button">
            {% include "recipes/icons/add.html" %}
          </button>
          </div>
          <ul class="ingredient-list list-disc list-outside ml-8">
            {% for stepingr in grouped_ingredients|get_item:forloop.counter0 %}
            <li>
              {{ stepingr.non_field_errors }}
              {{ stepingr.step_index }}

              {{ stepingr.ingredient.errors }}
              {{ stepingr.ingredient|add_class:'form-select' }}

              {{ stepingr.quantity.errors }}
              {{ stepingr.quantity|add_class:'form-select' }}

              {{ stepingr.unit.errors }}
              {{ stepingr.unit|add_class:'form-select' }}
            </li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ol>


    <input type="submit" value="Create Recipe" class="btn mt-6">
</form>

<hr class="hr">

<a href="{% url 'recipe_list' %}">Cancel</a>

<li id="step-template" style="display: none;">
  <div class="flex flex-row items-center justify-center space-x-2">
    {{ form_steps.empty_form.instruction|add_class:'form-input grow ml-2' }}
    <button class="remove-ingredient btn-icon" type="button">
      {% include "recipes/icons/remove.html" %}
    </button>
    <button class="add-ingredient btn-icon" type="button">
      {% include "recipes/icons/add.html" %}
    </button>
  </div>
  <ul class="ingredient-list list-disc list-outside ml-8"></ul>
</li>

<li id="step-ingredient-template" style="display: none;">
  <input
    type="hidden"
    name="stepingr-__prefix__-step_index"
    value="__stepIndex__"
  >
  {{ form_stepingredients.empty_form.ingredient|add_class:'form-select' }}
  {{ form_stepingredients.empty_form.quantity|add_class:'form-input' }}
  {{ form_stepingredients.empty_form.unit|add_class:'form-select' }}
</li>

{% endblock %}

{% block scripts %}
<script src="{% static 'recipes/js/recipe_create.js' %}"></script>
{% endblock %}
