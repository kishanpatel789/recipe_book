{% extends "recipes/base.html" %}
{% load static %}
{% load recipe_extras %}

{% block title %}Create Recipe{% endblock %}

{% block content %}
<h1 class="text-3xl mt-6 mb-2">Create Recipe</h1>

<form method="POST">
    {% csrf_token %}
    {{ form.non_field_errors }}

    {{ form.name.errors }}
    {{ form.name|add_class:'form-input' }}


    <h2 class="text-2xl mt-2">Tags</h2>
    {{ form.tags.errors }}
    {{ form.tags }}

    <h2 class="text-2xl mt-2">Complementary Dishes</h2>
    {{ form.complementary.errors }}
    {{ form.complementary }}

    <hr class="hr">

    <div class="flex flex-row items-center mt-2">
      <h2 class="text-2xl pr-2">Steps</h2>
      <div class="flex flex-row items-center justify-center space-x-2">
        <button id="remove-step" type="button" class="btn-icon">
          {% include "recipes/icons/remove.html" %}
        </button>
        <button id="add-step" type="button" class="btn-icon">
          {% include "recipes/icons/add.html" %}
        </button>
      </div>

    </div>
    {{ form_steps.management_form }}
    {{ form_stepingredients.management_form }}

    <ol id="step-list">
      {% for step in form_steps %}
        <li data-step-index="{{ forloop.counter0 }}">
            {{ step.non_field_errors }}
            {{ step.instruction.errors }}
            {{ step.instruction|add_class:'form-input' }}
          <button class="remove-ingredient btn-icon" type="button">
            {% include "recipes/icons/remove.html" %}
          </button>
          <button class="add-ingredient btn-icon" type="button">
            {% include "recipes/icons/add.html" %}
          </button>
          <ul class="ingredient-list">
            {% for stepingr in grouped_ingredients|get_item:forloop.counter0 %}
            <li>
              {{ stepingr.non_field_errors }}
              {{ stepingr.step_index }}

              {{ stepingr.ingredient.errors }}
              {{ stepingr.ingredient }}

              {{ stepingr.quantity.errors }}
              {{ stepingr.quantity }}

              {{ stepingr.unit.errors }}
              {{ stepingr.unit }}
            </li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ol>


    <input type="submit" value="Create Recipe" class="btn">
</form>

<hr class="hr">

<a href="{% url 'recipe_list' %}">Cancel</a>

<li id="step-template" style="display: none;">
  {{ form_steps.empty_form.instruction }}
  <button class="remove-ingredient" type="button">-</button>
  <button class="add-ingredient" type="button">+</button>
  <ul class="ingredient-list"></ul>
</li>

<li id="step-ingredient-template" style="display: none;">
  <input
    type="hidden"
    name="stepingr-__prefix__-step_index"
    value="__stepIndex__"
  >
  {{ form_stepingredients.empty_form.ingredient }}
  {{ form_stepingredients.empty_form.quantity }}
  {{ form_stepingredients.empty_form.unit }}
</li>

{% endblock %}

{% block scripts %}
<script src="{% static 'recipes/js/recipe_create.js' %}"></script>
{% endblock %}
